<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maxium-scale=1.0 user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
    <title>会议注册详情</title>
</head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>

<body>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg navbar-light bg-light  ">
            <a class="navbar-brand h4">
                <img src="/static/src/images/logo.png">
            </a>
            <div class="collapse navbar-collapse" id="collapsibleNavId">
                <ul class="navbar-nav mr-auto mt-4 mt-lg-0 pt-2">
                    <li class="nav-item ml-2">
                        <a class="nav-link h4 " style="font-weight: bold" href="http://123.206.34.20/#">首页</a>
                    </li>
                    <li class="nav-item ml-4" style="font-size:20px;">
                        <a class="nav-link" href="/company/index/index">用户中心</a>
                    </li>
                </ul>

                <div id="top_right" class="form-inline my-2  mr-5 my-lg-0 pt-2">
                    <div id="login_before">
                        <button class="btn btn-outline-success my-2 my-sm-0 ml-4 pt-2" onclick=login()>登录</button>
                        <button class="btn btn-outline-success my-2 my-sm-0 ml-1 pt-2" onclick=sign_up()>注册</button>
                    </div>

                    <div id="login_after" class="d-flex flex-row-reverse">
                        <div id="subscribe" class="p-2">
                            <button class="btn btn-outline-success" onclick=subcribe()>收藏</button>
                        </div>
                        <div id="cancel_subscribe" class="p-2">
                            <button class="btn btn-outline-success" onclick=cancel_subscribe()>取消收藏</button>
                        </div>
                        <div id="login_after1" class="p-2">
                            <button class="btn btn-outline-success" onclick=logout()>注销</button>
                        </div>
                    </div>
                    <!-- <script type="text/javascript">  
                        $(document).ready(function()
                        {
                            $.ajax({
                                url:,
                                type:"post",
                                success:function(data){
                                $(login_before)
                                }
                            })
                        
                        })
                    </script>  -->
                </div>
            </div>
        </nav>
    </div>
    <div class="d-flex align-items-center justify-content-center " style="height:250px;;width:100%;background: #765784 ;background:transparent url(/static/src/images/testbackground.jpg) no-repeat;background-size:100%;color:#ffffff ">
        <div id="meetheader" class="text-center text-justify">

        </div>
    </div>
    <div class="container">
        <div class="card text-center">
            <div class="card-header">
                <ul class="nav nav-tabs  ">
                    <li class="nav-item" id="register_title">

                    </li>
                </ul>
            </div>
            <div class="tab-content mb-5">
                <div class="tab-pane active container-fluid" id="register_body">
                    <div class="card-body row m-5" id="new_here">
                        <div class=" col-5 offset-md-7 d-block ">
                            <button type="button" class="btn btn-outline-success ml-1" onclick=add()>新增人员</button>
                            <input class="form-control" id="file" type="file" style="display: none" name="fileUpload" accept="application/pdf,image/*" required onchange="file_change(this);">
                            <button id="load" type="button" class="btn btn-outline-success ml-1" onclick="$('#file').click()">上传缴费凭证</button>
                            <button class="btn btn-outline-success" onclick=register_submit()>提交结果</button>
                        </div>
                        <div class="card col-md-5 mr-5 mt-4" onmouseout="this.style.background='#ffffff'">
                            <div class="card-body pb-0 mb-0" id="card_title">
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">姓名</label>
                                        <input type="text" class="form-control col-md-8" id="name1" aria-describedby="helpId" placeholder="">
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">性别</label>
                                        <div class="col-md-8 ">
                                            <label class="radio-inline ">
                                                <input type="radio" value="男性" name="sex1">男性
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" value="女性" name="sex1">女性
                                            </label>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">是否住宿</label>
                                        <div class="col-md-8">
                                            <label class="radio-inline ">
                                                <input type="radio" value="1" name="identity1">是
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" value="0" name="identity1">否
                                            </label>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <button class="btn btn-outline-muted disabled">&nbsp;&nbsp;删除&nbsp;&nbsp;</button>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer id="footer" class="pt-5" >
        <div class="container-fluid text-center text-muted pb-1" style="height: 115px;;width:100%;background: #765784 ;background:transparent url(/static/src/images/footer.jpg) no-repeat;background-size:100%;color:#ffffff ">
            <h6 class="pt-5 mb-4">这是一个面向会议组织机构和参会人员的通用学术会议管理平台，旨在为会议主办方和学者之间搭建一个沟通的渠道</h6>
        </div>
        <div class="container" >
            <div class="row hidden-xs">
                <dl class="col-lg-2 offset-md-1 site-link pb-1">
                    <dt class=" pb-1">小组信息：</dt>
                    
                    <dd>善良之队</dd>
                    <dd>组号：12组</dd>
                    <dd>成员：9名</dd>
                    
                </dl>
                
                <dl class="col-lg-3 site-link pb-1">
                    <dt class=" pb-1">赞助商:</dt>
                    
                    <dd>北航软院教师：THB</dd>
                    
                </dl>
                <dl class="col-lg-3 site-link pb-1">
                    <dt class=" pb-1">相关协作系统</dt>
                    
                    <dd><a href="http://211.71.15.42:9011/" >在线协同团队教学系统</a></dd>
                    <dd><a href="/admin/index/index" >系统管理员页面</a></dd>
                    
                </dl>

                <dl class="col-lg-3 site-link pb-1">
                    <dt class=" pb-1">联系我们</dt>
                    
                    <dd><i class="fas fa-phone    "></i>电话：15043079731</dd>
                    <dd><i class="fa fa-envelope" aria-hidden="true"></i>邮箱：li609754893@163.com</dd>
                    <dd><i class="fas fa-location-arrow    "></i>学院路 北京航空航天大学</dd>
                </dl>
            </div>
        </div>
        <hr>
        <div class="copyright container text-center">
                Copyright  2018 善良之队 12组<br><br>
        </div>
    </footer>
    <script>
        // function file_submit() {
        //     $('#load').after('<input class="form-control" id="file" type="file"  name="fileUpload" style="display:none" accept="application/pdf,application/msword" required onchange="file_change(this);" >');
        //     document.getElementById("file").click();
        // };
        function file_change(target) {
            var fileSize = 0;
            var isIE = false
            if (isIE && !target.files) {
                var filePath = target.value;
                var fileSystem = new ActiveXObject("Scripting.FileSystemObject");
                var file = fileSystem.GetFile(filePath);
                fileSize = file.Size;
            }
            else {
                fileSize = target.files[0].size;
            }
            var size = fileSize / 1024;
            if (size > 1024 * 5) {
                alert("附件不能大于5M");
                target.value = "";
                return
            }
        }
        var form_num = 1;
        var message = "结果显示 ：";
        function subcribe() {
            $.post('/index/user/subscribeMeeting', { "meetingId": GetRequest(), "type": 1 }, function (result) {
                console.log(result)
                alert(result.msg)
                if (result.errNo == 0) {
                    $("#subscribe").hide()
                    $("#cancel_subscribe").show();
                }
            })
        }
        function cancel_subscribe() {
            $.post('/index/user/unsubscribeMeeting', { "meetingId": GetRequest() }, function (result) {
                console.log(result)
                alert(result.msg)
                if (result.errNo == 0) {
                    $("#subscribe").show()
                    $("#cancel_subscribe").hide();
                }
            })
        }
        function judge() {
            $.post('/meeting/register/ifsubmit', { "meetingId": GetRequest() }, function (result) {
                console.log(result)
                if (result.data.submission == 1) {
                    var str_title = ` <a id="register_title" class="nav-link text-muted active" data-toggle="tab" href="#register_body">参会注册</a>`
                    document.getElementById('register_title').innerHTML = str_title;
                    var str = ` <h4 class="card-title">第一作者</h4>
                                <p class="card-text">此栏用于填写论文第一作者信息</p>`
                    document.getElementById("card_title").innerHTML = str;
                }
                else {
                    var str_title = ` <a id="register_title" class="nav-link text-muted active" data-toggle="tab" href="#register_body">听会注册</a>`
                    document.getElementById('register_title').innerHTML = str_title;
                    var str = ` <h4 class="card-title">听会人</h4>
                                <p class="card-text">此栏用于填写听会人信息</p>`
                    document.getElementById("card_title").innerHTML = str;
                }
            })
        }
        function getsubscirbestatus() {
            $.post('/index/user/getSubscribeMeetingStatus', { "meetingId": GetRequest() }, function (result) {
                console.log(result)
                status = result.data.status
                if (status != 0) {
                    $("#subscribe").hide()
                }
                else {
                    $("#cancel_subscribe").hide()
                }
            })
        }
        function init() {
            $.post('/meeting/index/getMeetingDetail', { "meetingId": GetRequest() }, function (result) {
                info = result.data;
                var meetingBeginDate = new Date(info.meetingBeginDate)
                var meetingEndDate = new Date(info.meetingEndDate)
                date = meetingBeginDate.getFullYear() + "年" + meetingBeginDate.getMonth() + "月" + meetingBeginDate.getDate() + "日—" + meetingEndDate.getFullYear() + "年" + meetingEndDate.getMonth() + "月" + meetingEndDate.getDate() + "日"

                var str = `<h1>${info.title}</h1>
                    <h2>&nbsp;</h2>
                    <h5>${info.place}</h5>
                    <h5>${date}</h5>`;
                document.getElementById("meetheader").innerHTML = str;
            })
            var status
            $.ajax({
                type: "post",
                url: '/index/index/getLoginStatus',
                async: false,
                success: function (result) {
                    status = result.data.status
                }
            });

            if (status != 0) {
                var myurl = null;
                switch (status) {
                    case 1: myurl = '/index/user/getUserDetail'
                        getsubscirbestatus()
                        break
                    case 2: myurl = '/company/index/getCompanyDetail'
                        $("#subscribe").hide()
                        $("#cancel_subscribe").hide()
                        break
                    case 3: myurl = '/company/index/getCompanyUnitDetail'
                        $("#subscribe").hide()
                        $("#cancel_subscribe").hide()
                        break
                }
                $.ajax({
                    type: "post",
                    url: myurl,
                    async: false,
                    success: function (result) {
                        var str_user = ` <div id="login_after2" class="p-2">
                            <button class="btn btn-outline-success border-0"  id='username' ><h5>${result.data.name}<h5></button>
                        </div>`
                        document.getElementById('login_after').innerHTML += str_user
                        $("#login_before").hide()
                    }
                });
            }
            else {
                $("#login_after1").hide()
                $("#login_after2").hide()
                $("#subscribe").hide()
                $("#cancel_subscribe").hide()
            }
            judge();
        }
        init();
        function GetRequest() {
            var url = location.search;
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("=");
                return strs[1];
            }
        }
        function login() {
            window.location.href = '/index/login/index'
        }
        function add() {
            form_num++;
            console.log(form_num)
            var str = `<div class="card-body pb-0 mb-0">
                                <h4 class="card-title">其他</h4>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">姓名</label>
                                        <input type="text" class="form-control col-md-8" id="name${form_num}" aria-describedby="helpId" placeholder="">
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">性别</label>
                                        <div class="col-md-8 ">
                                            <label class="radio-inline ">
                                                <input type="radio" value="男性" name="sex${form_num}">男性
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" value="女性" name="sex${form_num}">女性
                                            </label>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                        <label class="col-md-4" for="">是否住宿</label>
                                        <div class="col-md-8">
                                            <label class="radio-inline ">
                                                <input type="radio" value="1" name="identity${form_num}">是
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" value="0" name="identity${form_num}">否
                                            </label>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="form-group row d-flex align-items-center justify-content-center">
                                       <button class="btn btn-outline-danger" onclick="$(this).parent().parent().parent().parent().remove();form_num--;console.log(form_num);">&nbsp;&nbsp;删除&nbsp;&nbsp;</button>
                                    </div>
                                </li>
                            </ul>`
            var node = document.createElement("div");
            node.setAttribute("class", "card col-md-5 mr-5 mt-4")
            node.setAttribute("onmouseout","this.style.background='#ffffff'");
            node.innerHTML = str;
            document.getElementById("new_here").appendChild(node);
        }
        function sign_up() {
            window.location.href = '/index/login/signup'
        }
        function logout() {
            $.post('/index/login/logout', function (result) {
                location.reload();
            });
        }
        function monthConvert(month) {
            switch (month) {
                case 1:
                    return 'JAN';
                case 2:
                    return 'FEB';
                case 3:
                    return 'MAR';
                case 4:
                    return 'APR';
                case 5:
                    return 'MAY';
                case 6:
                    return 'JUNE';
                case 7:
                    return 'JULY';
                case 8:
                    return 'AUG';
                case 9:
                    return 'SEP';
                case 10:
                    return 'OCT';
                case 11:
                    return 'NOV';
                case 12:
                    return 'DEC';
            }
        }
        function register_submit() {
            $.post(' /meeting/register/createRegister', { "meetingId": GetRequest() }, function (result) {
                console.log(result)
                var registerId = result.data.registerId;
                var registers = new Array(form_num);
                for (var i = 1; i <= form_num; i++) {
                    var temp = {
                        "name": $("#name" + i).val(),
                        "gender": $("input[name='sex" + i + "']:checked").val(),
                        "accomodation": $("input[name='identity" + i + "']:checked").val(),
                    }
                    registers[i - 1] = (temp)
                    console.log(temp)
                }
                registers = JSON.stringify(registers);
                $.ajax({
                type: "post",
                url: '/meeting/register/createRegisterPerson',
                async: false,
                data:{ "registerId":registerId,"registerPersonList": registers },
                success: function (result) {
                    console.log(result)
                }
            });
                var file = document.getElementById('file').files[0];
                if (file == null) {
                    alert('请选择上传的文件。');
                    return;
                }
                var fileName = file.name.trim();
                console.log('fileName:' + fileName);
                var fileUrl = null
                var formData = new FormData();
                formData.append('file', file);
                formData.append('registerId', registerId);
                formData.append('fileName', fileName);
                $.ajax({
                    type: 'post',
                    url: "/meeting/register/uploadReigsterAddition",
                    data: formData,
                    processData: false,
                    contentType: false,
                    dataType: 'json',
                    async: false,
                    success: function (data) {
                       alert(result.msg)
                       window.location.href('/meeting/index/index')
                    }
                })

            });
        }
    //    function status_init() {
    //         var status
    //         $.ajax({
    //             type: "post",
    //             url: "index/index/getLoginStatus",
    //             async: false,
    //             success: function (result) {
    //                 status = result.data.status
    //             }
    //         });
    //         console.log(status)
    //         if (status != 0) {
    //             var myurl = null;
    //             switch (status) {
    //                 case 1: myurl = 'index/user/getUserDetail'
    //                     getsubscirbestatus();
    //                     break
    //                 case 2: myurl = 'company/index/getCompanyDetail'
    //                     $("#subscribe").hide()
    //                     $("#cancel_subscribe").hide()
    //                     break
    //                 case 3: myurl = 'company/index/getCompanyUnitDetail'
    //                     $("#subscribe").hide()
    //                     $("#cancel_subscribe").hide()
    //                     break
    //             }
    //             console.log(myurl)
    //             $.ajax({
    //                 type: "post",
    //                 url: myurl,
    //                 async: false,
    //                 success: function (result) {
    //                     console.log(result)
    //                     $("#username").text(result.data.name)
    //                     $("#login_before").hide()
    //                 }
    //             });
    //         }
    //         else {
    //             console.log($("#login_after").html)
    //             $("#login_after").hide()
    //         }
    //     }
    </script>

</body>

</html>
<style>
    div.card {
        box-shadow: 0px 4px 8px 0 rgba(0, 0, 0, 0.014), 0 6px 20px 0 rgba(0, 0, 0, 0.048);
        text-align: center;
        border: 0px
    }
    div.card:hover{
        box-shadow: 0px 4px 8px 0 rgba(0, 0, 0, 0.104), 0 6px 20px 0 rgba(0, 0, 0, 0.048);
    }
</style>